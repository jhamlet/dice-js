(function(){var doc=typeof document!="undefined"?document:!1,hdr=doc&&doc.getElementsByTagName("head")[0],$i=this.__infuse__=function(modId,callback){var src,node,module=$i.modules[modId];if(!module.exports){src=module;module=$i.modules[modId]={exports:{},loading:!0,loaded:!1,loadCallback:callback};if(typeof src=="function")src();else if(typeof src=="string"){src="(function(){\nvar module = __infuse__.modules["+modId+"],\n"+"exports = module.exports\n"+";\n"+src+"\n"+"__infuse__.clear("+modId+");\n"+"}());";if(doc){hdr=doc.getElementsByTagName("head")[0];node=doc.createElement("script");node.innerHTML=src;module.loadCallback=function(a){hdr.removeChild(node);callback&&callback(a)};hdr.appendChild(node)}else eval(src)}}return module.exports};$i.clear=function(a){var b=$i.modules[a],c=b.loadCallback;b.loading=!1;b.loaded=!0;delete b.loadCallback;c&&c(b.exports)};__infuse__.modules={0:"function a(a,b,c){return Array.prototype.slice.call(a,b,c)}function b(){var b=a(arguments);return b.reduce(function(a,b){return Object.keys(b).reduce(function(a,c){a[c]=b[c];return a},a)},b.shift())}function c(a,b){return a-b}function d(a){return Math.floor(Math.random()*a)+1}function e(a,b){return a+b}module.exports={slice:a,merge:b,numericSort:c,rollDie:d,reduceSum:e};b(module.exports,__infuse__(1))",1:"(function(){function c(c,d){return a.merge({},b,{value:c},d||{})}function d(b,d){return a.merge(c(b,d),{enumerable:!1})}var a=__infuse__(0),b={enumerable:!0,writable:!0,configurable:!0};module.exports={property:c,method:c,privateProperty:d,privateMethod:d}})()"}})();(function(a){function g(a,b,d){if(arguments.length===1){b=a;a=1}this.count=a;this.sides=b;Object.defineProperty(this,"_behaviors",c.privateProperty([]));d&&this.addBehavior.apply(this,d)}function h(){var a=this.init;a&&typeof a=="function"&&a.apply(this,arguments)}function i(a,e){var f=function(){h.apply(this,arguments)};c.merge(f.prototype=d(h.prototype),e);return b[a]=f}function j(a){var e,f,g=b[a];if(!g)throw new Error("Unknown behavior '"+a+"'");e=g.prototype;if(typeof e.init=="function"){f=d(e);g.apply(f,c.slice(arguments,1));return f}return e}function k(a,b){return function(c){var d=new g(c,a);b&&b.forEach(function(a){d.addBehavior(f(a)?j.apply(null,a):j(a))});return d}}var b,c=__infuse__(0),d=Object.create,e=function(){},f=Array.isArray;g.prototype=d(Object.prototype,{count:c.property(1),sides:c.property(0),rolled:c.property(!1),total:c.property(0),roll:c.method(function(){if(this.rolled)return this.total;this.total=this._roll();this.rolled=!0;this._applyBehaviors("roll");return this.total}),reroll:c.method(function(){this.reset();return this.roll()}),reset:c.method(function(){delete this.total;delete this.results;delete this.rolled;this._applyBehaviors("reset");return this}),addBehavior:c.method(function(){c.slice(arguments).forEach(function(a){this.push(a)},this._behaviors);return this}),toString:c.method(function(){var a,b={count:this.count,sides:this.sides,total:this.total,modifiers:[],results:this.results||[],suffix:"",addenda:""};this._applyBehaviors("toString",[b]);a=b.modifiers.reduce(c.reduceSum,0);return(b.count>1?b.count:"")+"d"+b.sides+(a!==0?a>0?"+"+a:a:"")+(this.rolled?" ["+this.results.join(", ")+"] = "+b.total+(b.suffix?b.suffix:"")+(b.addenda?" ("+b.addenda+")":""):"")}),_roll:c.privateMethod(function(){var a,b=0,d=this.count,e=this.sides,f=0,g=this.results=[];for(b;b<d;b++){a=c.rollDie(e);g.push(a);f+=a}return f}),_applyBehaviors:c.privateMethod(function(a,b){b=b||[];b.unshift(this);this._behaviors.forEach(function(c){c[a].apply(c,b)},this);return this})});g.behaviors=b={};h.prototype=d(Object.prototype,{roll:c.method(e),reset:c.method(e),toString:c.method(e)});g.DiceBehavior=h;g.createBehavior=i;g.getBehavior=j;g.makeDiceFactory=k;i("ResultModifier",{init:function(a){this.amount=a},roll:function(a){a.total+=this.amount},toString:function(a,b){b.modifiers.push(this.amount)}});i("DieModifier",{init:function(a){this.amount=a},roll:function(a){a.total+=this.amount*a.count},toString:function(a,b){b.modifiers.push(this.amount*a.count)}});i("RemoveLowest",{init:function(a){this.amount=a},roll:function(a){var b=a.results.sort(c.numericSort).reverse();a.lowResults=b.splice(a.count-this.amount);a.total=b.reduce(c.reduceSum,0)},reset:function(a){delete a.lowResults},toString:function(a,b){b.addenda+="low: ["+a.lowResults.join(", ")+"]"}});i("SuccessDice",{init:function(a){this.minimum=a},roll:function(a){var b,c,d=0,e=0,f=a.results,g=f.length,h=a.count,i=this.minimum;for(b=0;b<g;b++){c=f[b];c>=i?d++:b<h&&c===1&&e++}a.successes=d;a.failures=e;a.total=Math.max(d-e,0);a.fumbled=e>d},reset:function(a){delete a.successes;delete a.failures;delete a.fumbled},toString:function(a,b){b.suffix+=" successes"+(a.fumbled?"!":"")}});i("HeroNormalDice",{roll:function(a){a.body=a.results.reduce(function(a,b){switch(b){case 1:break;case 6:a+=2;break;default:a+=1}return a},0);a.stun=a.total},reset:function(a){delete a.body;delete a.stun},toString:function(a,b){b.suffix+=" stun, "+a.body+" body"}});i("WildDice",{init:function(a){this.amount=a||0},roll:function(a){var b=a.results.slice().reverse(),d=b.slice(0,this.amount||a.results.length),e=0;d.forEach(function(b){var d,f=a.sides;if(b===f){do{d=c.rollDie(f);a.results.push(d)}while(d===f)}else b===1&&e++});a.total=a.results.reduce(c.reduceSum,0);a.complications=e;a.complication=e>0},reset:function(a){delete a.wildDice;delete a.complication;delete a.complications},toString:function(a,b){var c=a.complication,d=a.complications;b.suffix+=c?Array(d+1).join("!"):""}});c.merge(a,{Dice:g,heroDice:k(6,["HeroNormalDice"]),shadowrunDice:k(6,["WildDice",["SuccessDice",5]]),d6StarWarsDice:function(a,b){var c=new g(a,6,[j("WildDice",1)]);typeof b=="number"&&c.addBehavior(j("ResultModifier",b));return c}})})(typeof module!="undefined"&&module.exports||(this.dice={}))