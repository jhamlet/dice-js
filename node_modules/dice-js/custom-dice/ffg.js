
var Behavior = require("dice-js/behavior"),
    Factory = require("dice-js/factory")
;

//---------------------------------------------------------------------------
// Behaviors
//---------------------------------------------------------------------------
function create (name, columns, table) {

    function results (dice, values) {
        var cols = this.res,
            table = this.table
        ;
        
        return values.map(function (result) {
            return cols.reduce(function (acc, col, idx) {
                acc[col] = table[idx][result];
                return acc;
            }, {});
        });
    }
    
    function result (dice, value) {
        return dice.results.reduce(function (acc, result) {
            Object.keys(result).forEach(function (key) {
                if (acc.hasOwnPoperty(key)) {
                    acc[key] += result[key];
                }
            });
            return acc;
        }, {});
    }
    
    return new Behavior(name, {
        columns: columns,
        table:   table,
        results: results,
        result:  result
    });
}

create("FfgStarWarsBoostDie",
    ["success", "advantage"],
    [ 
        [0, 0],
        [0, 0],
        [0, 2],
        [2, 0],
        [0, 1],
        [0, 1]
    ]
);

create("FfgStarWarsSetbackDie",
    ["failure", "threat"],
    [ 
        [0, 0],
        [0, 0],
        [1, 0],
        [1, 0],
        [0, 1],
        [0, 1]
    ]
);

create("FfgStarWarsAbilityDie", 
    ["success", "advantage"],
    [ 
        [0, 0],
        [1, 0],
        [1, 0],
        [2, 0],
        [0, 1],
        [0, 1],
        [1, 1],
        [0, 2]
    ]
);

create("FfgStarWarsDifficultyDie", 
    ["failure", "threat"],
    [ 
        [0, 0],
        [1, 0],
        [2, 0],
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 2],
        [1, 1]
    ]
);

create("FfgStarWarsProficiencyDie", 
    ["success", "advantage", "triumph"],
    [
        [0, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [2, 0, 0], 
        [2, 0, 0], 
        [0, 1, 0], 
        [1, 1, 0], 
        [1, 1, 0],
        [1, 1, 0],
        [0, 2, 0],
        [0, 2, 0],
        [0, 0, 1]
    ]
);

create("FfgStarWarsChallengeDie", 
    ["failure", "threat", "despair"],
    [
        [0, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [2, 0, 0],
        [2, 0, 0],
        [0, 1, 0],
        [0, 1, 0],
        [1, 1, 0],
        [1, 1, 0],
        [0, 2, 0],
        [0, 2, 0],
        [0, 0, 1]
    ]
);

create("FfgStarWarsForceDie", 
    ["lightside", "darkside"],
    [
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 2],
        [1, 0],
        [1, 0],
        [2, 0],
        [2, 0],
        [2, 0]
    ]
);

//---------------------------------------------------------------------------
// Factories
//---------------------------------------------------------------------------
new Factory("FfgStarWarsBoostDice",        6, "FfgStarWarsBoostDie");
new Factory("FfgStarWarsSetBackDice",      6, "FfgStarWarsSetbackDie");
new Factory("FfgStarWarsAbilityDice",      8, "FfgStarWarsAbilityDie");
new Factory("FfgStarWarsDifficultyDice",   8, "FfgStarWarsDifficultyDie");
new Factory("FfgStarWarsProficiencyDice", 12, "FfgStarWarsProficiencyDie");
new Factory("FfgStarWarsForceDice",       12, "FfgStarWarsForceDie");
