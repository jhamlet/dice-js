
var Behavior = require("dice-js/behavior"),
    Factory  = require("dice-js/factory")
;

//---------------------------------------------------------------------------
// Star Wars Helpers
//---------------------------------------------------------------------------
function starWarsBehavior (name, columns, table) {

    function results (dice, values) {
        var cols  = this.columns,
            table = this.table
        ;
        
        return values.map(function (result) {
            return cols.reduce(function (acc, col, idx) {
                acc[col] = table[result-1][idx];
                return acc;
            }, Object.defineProperty({}, "_", { value: result }));
        });
    }
    
    function result (dice, value) {
        return dice.results.reduce(function (acc, result) {
            Object.keys(result).forEach(function (key) {
                if (acc.hasOwnProperty(key)) {
                    acc[key] += result[key];
                }
                else {
                    acc[key] = result[key];
                }
            });
            return acc;
        }, {});
    }
    
    return new Behavior("FfgStarWars" + name, {
        columns: columns,
        table:   table,
        results: results,
        result:  result
    });
}

function starWarsFactory (name, faces, behavior) {
    return new Factory("FfgStarWars" + name, faces, behavior);
}

function starWarsDice (name, faces, columns, table) {
    return starWarsFactory(
        name + "Dice",
        faces,
        starWarsBehavior(name + "Die", columns, table).name
    );
}
//---------------------------------------------------------------------------
// Star Wars Definitions
//---------------------------------------------------------------------------
starWarsDice("Boost", 6, ["success", "advantage"], [
    [0, 0],
    [0, 0],
    [0, 2],
    [0, 1],
    [1, 1],
    [1, 0]
]);

starWarsDice("Setback", 6, ["failure", "threat"], [
    [0, 0],
    [0, 0],
    [1, 0],
    [1, 0],
    [0, 1],
    [0, 1]
]);

starWarsDice("Ability", 8, ["success", "advantage"], [
    [0, 0],
    [1, 0],
    [1, 0],
    [2, 0],
    [0, 1],
    [0, 1],
    [1, 1],
    [0, 2]
]);

starWarsDice("Difficulty", 8, ["failure", "threat"], [ 
    [0, 0],
    [1, 0],
    [2, 0],
    [0, 1],
    [0, 1],
    [0, 1],
    [0, 2],
    [1, 1]
]);

starWarsDice("Proficiency", 12, ["success", "advantage", "triumph"], [
    [0, 0, 0],
    [1, 0, 0],
    [1, 0, 0],
    [2, 0, 0],
    [2, 0, 0],
    [0, 1, 0],
    [1, 1, 0],
    [1, 1, 0],
    [1, 1, 0],
    [0, 2, 0],
    [0, 2, 0],
    [0, 0, 1]
]);

starWarsDice("Challenge", 12, ["failure", "threat", "despair"], [
    [0, 0, 0],
    [1, 0, 0],
    [1, 0, 0],
    [2, 0, 0],
    [2, 0, 0],
    [0, 1, 0],
    [0, 1, 0],
    [1, 1, 0],
    [1, 1, 0],
    [0, 2, 0],
    [0, 2, 0],
    [0, 0, 1]
]);

starWarsDice("Force", 12, ["lightside", "darkside"], [
    [0, 1],
    [0, 1],
    [0, 1],
    [0, 1],
    [0, 1],
    [0, 1],
    [0, 2],
    [1, 0],
    [1, 0],
    [2, 0],
    [2, 0],
    [2, 0]
]);
