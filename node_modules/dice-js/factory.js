
var Proteus  = require("proteus"),
    Dice     = require("dice-js/dice"),
    Behavior = require("dice-js/behavior")
;

module.exports = Proteus.Class.derive({
    
    self: Object.defineProperties({
        
        initialize: function (instance, args) {
            var name        = args[0],
                faces       = args[1],
                behaviors   = Proteus.slice(args, 2),
                factory     = this.__factories__[name]
            ;
            
            if (factory) { return factory; }
            
            // Fetch the behaviors now to determine if any are not defined.
            behaviors = behaviors.map(function (behavior) {
                return Behavior.get(behavior);
            });

            Dice[name] = factory = this.__factories__[name] = function (num) {
                var dice = new Dice(num || 1, faces);
                behaviors.forEach(function (behavior) {
                    behavior.attach(dice);
                });
                return dice;
            };
            
            return factory;
        }
    }, {
        __factories__: { value: {} }
    })
    
});
