
var Operator = require("dice-js/operator");

Operator.define("Addition", {
    symbol: "+",
    operation: function (lVal, rVal) {
        var lValIsArray = Array.isArray(lVal),
            rValIsArray = Array.isArray(rVal),
            lValIsObj   = typeof lVal === "object",
            rValIsObj   = typeof rVal === "object"
        ;
        
        if (lValIsArray) {
            if (rValIsArray) {
                // is this the correct default?
                // should we add values from rVal to the corresponding values in lVal?
                return lVal.concat(rVal);
            }
            else if (rValIsObj) {
                return [lVal, rVal];
            }
            else {
                return lVal.map(function (val) {
                    return val + rVal;
                });
            }
        }
        else if (lValIsObj) {
            if (rValIsArray || !rValIsObj) {
                return [lVal, rVal];
            }
            else {
                return Object.keys(rVal).reduce(function (acc, key) {
                    if (acc[key] !== undefined) {
                        acc[key] += rVal[key];
                    }
                    else {
                        acc[key] = rVal[key];
                    }
                    return acc;
                }, Object.keys(lVal).reduce(function (acc, key) {
                    acc[key] = lVal[key];
                    return acc;
                }, {}));
            }
        }
        else {
            return lVal + rVal;
        }
    },
    precedence: 0,
    associativity: "left"
});
